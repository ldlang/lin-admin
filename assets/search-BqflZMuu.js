import{U as he,V as Y,a5 as me,a1 as W,aD as be,b as x,a_ as ye,J as _e,r as i,K as T,a$ as $e,C as Ee,o as C,k as Se,w as g,j as k,M as F,f as t,O as Z,e as I,c as B,L as _,H as we,b0 as Ae,F as Ce,h as Ie,p as ke,G as q,am as Ne,a7 as A,a8 as ee,al as Ve,N as Te,a2 as H,P as Fe,u as Be,b1 as De,g as Pe,q as Oe}from"./index-dFPmeL4W.js";import{u as Ke,E as Re}from"./index-Bn_AqGku.js";import{E as Le}from"./index-B4NeCrjO.js";import{u as Me,E as Ue}from"./index-B566OGEp.js";import{U as D,I as j,C as te}from"./event-BB_Ol6Sd.js";import{u as We}from"./use-form-item-DPjt9aXn.js";import{u as He}from"./constants-UV50Wn-e.js";import{t as qe}from"./error-Cq9Fpw4b.js";import{d as je}from"./debounce-DlU94wuu.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./focus-trap-DAb4nyX_.js";const ze=he({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:Y(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:Y([Function,Array]),default:me},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},label:{type:String},teleported:Me.teleported,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String}),Ge={[D]:r=>W(r),[j]:r=>W(r),[te]:r=>W(r),focus:r=>r instanceof FocusEvent,blur:r=>r instanceof FocusEvent,clear:()=>!0,select:r=>be(r)},Je=["aria-expanded","aria-owns"],Qe={key:0},Xe=["id","aria-selected","onClick"],ae="ElAutocomplete",Ye=x({name:ae,inheritAttrs:!1}),Ze=x({...Ye,props:ze,emits:Ge,setup(r,{expose:P,emit:u}){const o=r,N=Ke(),O=ye(),$=We(),c=_e("autocomplete"),s=i(),d=i(),l=i(),h=i();let E=!1,K=!1;const f=i([]),n=i(-1),z=i(""),v=i(!1),V=i(!1),b=i(!1),S=He(),se=T(()=>O.style),m=T(()=>(f.value.length>0||b.value)&&v.value),G=T(()=>!o.hideLoading&&b.value),le=T(()=>s.value?Array.from(s.value.$el.querySelectorAll("input")):[]),oe=()=>{m.value&&(z.value=`${s.value.$el.offsetWidth}px`)},ne=()=>{n.value=-1},J=je(async e=>{if(V.value)return;const a=p=>{b.value=!1,!V.value&&(H(p)?(f.value=p,n.value=o.highlightFirstItem?0:-1):qe(ae,"autocomplete suggestions must be an array"))};if(b.value=!0,H(o.fetchSuggestions))a(o.fetchSuggestions);else{const p=await o.fetchSuggestions(e,a);H(p)&&a(p)}},o.debounce),re=e=>{const a=!!e;if(u(j,e),u(D,e),V.value=!1,v.value||(v.value=a),!o.triggerOnFocus&&!e){V.value=!0,f.value=[];return}J(e)},ue=e=>{var a;$.value||(((a=e.target)==null?void 0:a.tagName)!=="INPUT"||le.value.includes(document.activeElement))&&(v.value=!0)},ie=e=>{u(te,e)},ce=e=>{K?K=!1:(v.value=!0,u("focus",e),o.triggerOnFocus&&!E&&J(String(o.modelValue)))},pe=e=>{setTimeout(()=>{var a;if((a=l.value)!=null&&a.isFocusInsideContent()){K=!0;return}v.value&&w(),u("blur",e)})},de=()=>{v.value=!1,u(D,""),u("clear")},Q=async()=>{m.value&&n.value>=0&&n.value<f.value.length?R(f.value[n.value]):o.selectWhenUnmatched&&(u("select",{value:o.modelValue}),f.value=[],n.value=-1)},fe=e=>{m.value&&(e.preventDefault(),e.stopPropagation(),w())},w=()=>{v.value=!1},ve=()=>{var e;(e=s.value)==null||e.focus()},ge=()=>{var e;(e=s.value)==null||e.blur()},R=async e=>{u(j,e[o.valueKey]),u(D,e[o.valueKey]),u("select",e),f.value=[],n.value=-1},L=e=>{if(!m.value||b.value)return;if(e<0){n.value=-1;return}e>=f.value.length&&(e=f.value.length-1);const a=d.value.querySelector(`.${c.be("suggestion","wrap")}`),y=a.querySelectorAll(`.${c.be("suggestion","list")} li`)[e],M=a.scrollTop,{offsetTop:X,scrollHeight:U}=y;X+U>M+a.clientHeight&&(a.scrollTop+=U),X<M&&(a.scrollTop-=U),n.value=e,s.value.ref.setAttribute("aria-activedescendant",`${S.value}-item-${n.value}`)};return $e(h,()=>{m.value&&w()}),Ee(()=>{s.value.ref.setAttribute("role","textbox"),s.value.ref.setAttribute("aria-autocomplete","list"),s.value.ref.setAttribute("aria-controls","id"),s.value.ref.setAttribute("aria-activedescendant",`${S.value}-item-${n.value}`),E=s.value.ref.hasAttribute("readonly")}),P({highlightedIndex:n,activated:v,loading:b,inputRef:s,popperRef:l,suggestions:f,handleSelect:R,handleKeyEnter:Q,focus:ve,blur:ge,close:w,highlight:L}),(e,a)=>(C(),Se(t(Ue),{ref_key:"popperRef",ref:l,visible:t(m),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[t(c).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${t(c).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:oe,onHide:ne},{content:g(()=>[k("div",{ref_key:"regionRef",ref:d,class:F([t(c).b("suggestion"),t(c).is("loading",t(G))]),style:Z({[e.fitInputWidth?"width":"minWidth"]:z.value,outline:"none"}),role:"region"},[I(t(Le),{id:t(S),tag:"ul","wrap-class":t(c).be("suggestion","wrap"),"view-class":t(c).be("suggestion","list"),role:"listbox"},{default:g(()=>[t(G)?(C(),B("li",Qe,[_(e.$slots,"loading",{},()=>[I(t(we),{class:F(t(c).is("loading"))},{default:g(()=>[I(t(Ae))]),_:1},8,["class"])])])):(C(!0),B(Ce,{key:1},Ie(f.value,(p,y)=>(C(),B("li",{id:`${t(S)}-item-${y}`,key:y,class:F({highlighted:n.value===y}),role:"option","aria-selected":n.value===y,onClick:M=>R(p)},[_(e.$slots,"default",{item:p},()=>[ke(q(p[e.valueKey]),1)])],10,Xe))),128))]),_:3},8,["id","wrap-class","view-class"])],6)]),default:g(()=>[k("div",{ref_key:"listboxRef",ref:h,class:F([t(c).b(),e.$attrs.class]),style:Z(t(se)),role:"combobox","aria-haspopup":"listbox","aria-expanded":t(m),"aria-owns":t(S)},[I(t(Re),Ne({ref_key:"inputRef",ref:s},t(N),{clearable:e.clearable,disabled:t($),name:e.name,"model-value":e.modelValue,onInput:re,onChange:ie,onFocus:ce,onBlur:pe,onClear:de,onKeydown:[a[0]||(a[0]=A(ee(p=>L(n.value-1),["prevent"]),["up"])),a[1]||(a[1]=A(ee(p=>L(n.value+1),["prevent"]),["down"])),A(Q,["enter"]),A(w,["tab"]),A(fe,["esc"])],onMousedown:ue}),Ve({_:2},[e.$slots.prepend?{name:"prepend",fn:g(()=>[_(e.$slots,"prepend")])}:void 0,e.$slots.append?{name:"append",fn:g(()=>[_(e.$slots,"append")])}:void 0,e.$slots.prefix?{name:"prefix",fn:g(()=>[_(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:g(()=>[_(e.$slots,"suffix")])}:void 0]),1040,["clearable","disabled","name","model-value","onKeydown"])],14,Je)]),_:3},8,["visible","placement","popper-class","teleported","transition"]))}});var et=Te(Ze,[["__file","autocomplete.vue"]]);const tt=Fe(et),at={class:"top-search"},st={class:"flex flex-justify-between"},lt={class:"fw-bold"},ot={class:"text-10"},nt=x({__name:"search",setup(r){const{menuList:P}=Be(),u=Oe(),o=i(""),N=i([]);(function(){const s=d=>{d.forEach(l=>{var h,E;((h=l.children)==null?void 0:h.length)>0?s(l.children):l.meta.isSearch&&((E=N.value)==null||E.push({path:l.path,title:l.meta.title}))})};s(De(P))})();function O(s,d){const l=N.value.filter(h=>h.title.includes(s));d(l)}const $=i();function c(s){var l;o.value="";const{path:d}=s;u.push(d),(l=$.value)==null||l.blur()}return(s,d)=>(C(),B("div",at,[I(t(tt),{modelValue:t(o),"onUpdate:modelValue":d[0]||(d[0]=l=>Pe(o)?o.value=l:null),ref_key:"autocomplete",ref:$,"fetch-suggestions":O,placeholder:"请输入关键字进行搜索",onSelect:c},{default:g(({item:l})=>[k("div",st,[k("div",lt,q(l.title),1),k("span",ot,q(l.path),1)])]),_:1},8,["modelValue"])]))}}),yt=xe(nt,[["__scopeId","data-v-b8f76a1e"]]);export{yt as default};
